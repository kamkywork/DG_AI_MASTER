<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI MASTER V.7 PRO - ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</title>
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;600;700&family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root { --bg-body: #050505; --bg-card: #121212; --primary: #ffd700; --p-color: #2196f3; --b-color: #ff1744; --t-color: #43a047; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Sarabun', sans-serif; }
        body { background-color: var(--bg-body); color: #fff; margin: 0; display: flex; justify-content: center; }
        .app-frame { width: 100%; max-width: 480px; background: var(--bg-card); min-height: 100vh; display: flex; flex-direction: column; border: 1px solid #333; position: relative; }
        
        /* ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ */
        .header { padding: 15px; background: #1a1a1a; border-bottom: 2px solid var(--primary); text-align: center; }
        .logo { font-family: 'Teko'; font-size: 2rem; font-weight: 700; letter-spacing: 2px; }
        .logo span { color: var(--primary); }
        .server-select { width: 100%; padding: 12px; background: #000; border: 1px solid #444; color: #fff; border-radius: 8px; margin-top: 10px; font-weight: 600; }

        .content { padding: 15px; flex: 1; padding-bottom: 140px; }
        
        /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå AI */
        .ai-card { background: linear-gradient(145deg, #1a1a1a, #0a0a0a); border-radius: 20px; padding: 25px; text-align: center; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.8); }
        .ai-result { font-family: 'Teko'; font-size: 5rem; font-weight: 700; line-height: 1; margin: 10px 0; letter-spacing: 3px; }
        .c-p { color: var(--p-color); text-shadow: 0 0 15px rgba(33,150,243,0.5); }
        .c-b { color: var(--b-color); text-shadow: 0 0 15px rgba(255,23,68,0.5); }
        .c-w { color: #555; }
        
        .bar-bg { background: rgba(255,255,255,0.05); height: 10px; border-radius: 5px; margin: 15px 0; overflow: hidden; }
        .bar-fill { height: 100%; width: 0%; transition: width 0.8s cubic-bezier(0.1, 0.7, 1.0, 0.1); background: var(--primary); }

        /* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô */
        .money-box { background: rgba(255,255,255,0.03); border-radius: 12px; padding: 15px; margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; border: 1px solid #222; }
        .m-label { font-size: 0.75rem; color: #888; }
        .m-val { font-family: 'Teko'; font-size: 2.2rem; font-weight: 600; }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏á‡∏¥‡∏ô & Stop Loss */
        .settings-box { background: rgba(255,255,255,0.03); border-radius: 12px; padding: 15px; margin-top: 15px; border: 1px solid #222; }
        .set-label { font-size: 0.8rem; color: #888; margin-bottom: 8px; font-weight: 600; }
        .step-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-bottom: 15px; }
        .set-input { width: 100%; background: #000; border: 1px solid #444; color: var(--primary); padding: 8px 5px; border-radius: 6px; text-align: center; font-family: 'Teko', sans-serif; font-size: 1.2rem; outline: none; transition: 0.3s; }
        .set-input:focus { border-color: var(--primary); box-shadow: 0 0 5px rgba(255,215,0,0.3); }
        .stop-loss-input { width: 100%; text-align: left; padding: 8px 15px; color: #ff1744; }

        /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Big Road */
        .road-header { font-size: 0.8rem; color: #666; margin: 15px 0 5px 5px; font-weight: 600; }
        .grid-container { background: #000; border-radius: 10px; padding: 5px; overflow-x: auto; border: 1px solid #222; }
        .grid-table { border-collapse: collapse; }
        .g-cell { width: 26px; height: 26px; border: 1px solid #111; position: relative; }
        
        /* ‡πÄ‡∏°‡πá‡∏î‡∏™‡∏µ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
        .bead { width: 20px; height: 20px; border-radius: 50%; margin: auto; position: relative; }
        .bd-p { background: var(--p-color); }
        .bd-b { background: var(--b-color); }
        /* ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡πÄ‡∏™‡∏°‡∏≠ (‡∏Ç‡∏µ‡∏î‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß) */
        .tie-slash { position: absolute; width: 100%; height: 2px; background: #00e676; top: 50%; left: 0; transform: rotate(-45deg); box-shadow: 0 0 3px #000; z-index: 10; }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° */
        .controls { position: fixed; bottom: 0; left: 0; right: 0; max-width: 480px; margin: 0 auto; background: #0a0a0a; padding: 12px; border-top: 1px solid #333; box-shadow: 0 -5px 20px rgba(0,0,0,0.5); }
        .btn-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .btn { border: none; border-radius: 12px; padding: 12px 0; font-family: 'Teko'; font-size: 1.8rem; color: #fff; cursor: pointer; transition: 0.1s; font-weight: 700; }
        .btn-p { background: var(--p-color); border-bottom: 4px solid #0d47a1; }
        .btn-t { background: var(--t-color); border-bottom: 4px solid #1b5e20; }
        .btn-b { background: var(--b-color); border-bottom: 4px solid #b71c1c; }
        .btn:active { transform: translateY(2px); border-bottom-width: 0; }
        .sub-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .sub-btn { padding: 10px; background: #222; color: #aaa; border: 1px solid #333; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; }
    </style>
</head>
<body>
<div class="app-frame" id="captureArea">
    <header class="header">
        <div class="logo">AI MASTER <span>V.7 PRO</span></div>
        <select id="providerSelect" class="server-select" onchange="analyze()">
            <option value="sa">‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå 1: SA GAMING (‡∏î‡∏±‡∏Å‡∏°‡∏±‡∏á‡∏Å‡∏£)</option>
            <option value="sexy">‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå 2: AE SEXY (‡∏î‡∏±‡∏Å‡∏õ‡∏¥‡∏á‡∏õ‡∏≠‡∏á)</option>
            <option value="dg">‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå 3: DREAM GAMING (‡∏™‡∏°‡∏î‡∏∏‡∏•)</option>
        </select>
    </header>

    <main class="content">
        <div style="display:flex; justify-content:space-between; margin-bottom:12px;">
            <div style="background:#151515; padding:8px 15px; border-radius:10px; width:48%;">
                <div class="m-label">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∞‡∏™‡∏°</div>
                <div id="profitVal" style="font-family:'Teko'; font-size:1.6rem; color:#00e676;">0</div>
            </div>
            <div style="background:#151515; padding:8px 15px; border-radius:10px; width:48%; text-align:right;">
                <div class="m-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
                <div id="lastResTxt" style="font-weight:700;">-</div>
            </div>
        </div>

        <div class="ai-card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:0.8rem; font-weight:700; color:#666;">‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏∞‡∏ö‡∏ö AI</span>
                <span id="aiConfTxt" style="font-family:'Teko'; color:var(--primary); font-size:1.4rem;">0%</span>
            </div>
            <div id="aiResult" class="ai-result c-w">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
            <div class="bar-bg"><div id="confBar" class="bar-fill"></div></div>
            <div id="aiReason" style="font-size:0.85rem; color:#888;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏≤...</div>

            <div class="money-box">
                <div>
                    <div class="m-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á (BET)</div>
                    <div class="m-val" id="nextBetTxt" style="color:var(--primary);">100</div>
                </div>
                <div style="text-align:right;">
                    <div class="m-label">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</div>
                    <div id="stepNameTxt" style="font-size:1rem; font-weight:700; margin-top:10px;">‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà 1</div>
                </div>
            </div>
        </div>

        <div class="settings-box">
            <div class="set-label">‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (5 ‡πÑ‡∏°‡πâ) - ‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì x ‡∏ó‡∏∏‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (100)</div>
            <div class="step-grid">
                <input type="number" id="step1" class="set-input" value="1" onchange="updateUI()">
                <input type="number" id="step2" class="set-input" value="2" onchange="updateUI()">
                <input type="number" id="step3" class="set-input" value="4" onchange="updateUI()">
                <input type="number" id="step4" class="set-input" value="8" onchange="updateUI()">
                <input type="number" id="step5" class="set-input" value="16" onchange="updateUI()">
            </div>
            
            <div class="set-label">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Stop Loss (‡∏ï‡∏±‡∏î‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î)</div>
            <input type="number" id="stopLossLimit" class="set-input stop-loss-input" value="-1000" onchange="updateUI()">
        </div>

        <div class="settings-box" data-html2canvas-ignore="true">
            <div class="set-label" style="text-align: center;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</div>
            <div class="sub-row" style="margin-top: 10px;">
                <button class="sub-btn" style="background: #0277bd; border-color: #01579b; color: #fff;" onclick="exportJPG()">üì∏ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• (JPG)</button>
                <button class="sub-btn" style="background: #c62828; border-color: #b71c1c; color: #fff;" onclick="exportPDF()">üìÑ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• (PDF)</button>
            </div>
        </div>

        <div class="road-header">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏Ñ‡πâ‡∏≤‡πÑ‡∏û‡πà‡∏´‡∏•‡∏±‡∏Å (BIG ROAD)</div>
        <div class="grid-container" id="bigRoad"></div>
    </main>

    <footer class="controls" data-html2canvas-ignore="true">
        <div class="btn-row">
            <button class="btn btn-p" onclick="addRes('P')">PLAYER</button>
            <button class="btn btn-t" onclick="addRes('T')">TIE</button>
            <button class="btn btn-b" onclick="addRes('B')">BANKER</button>
        </div>
        <div class="sub-row">
            <button class="sub-btn" onclick="undo()">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö (Undo)</button>
            <button class="sub-btn" onclick="resetGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà (Reset)</button>
        </div>
    </footer>
</div>

<script>
    let history = []; 
    let stateHistory = []; 
    let balance = 0;
    let betStep = 0;
    let lastPred = null;

    // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ UI
    function getMartSteps() {
        return [
            parseFloat(document.getElementById('step1').value) || 1,
            parseFloat(document.getElementById('step2').value) || 2,
            parseFloat(document.getElementById('step3').value) || 4,
            parseFloat(document.getElementById('step4').value) || 8,
            parseFloat(document.getElementById('step5').value) || 16
        ];
    }

    function addRes(v) {
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Stop Loss 
        const stopLossLimit = parseFloat(document.getElementById('stopLossLimit').value) || -1000;
        if (balance <= stopLossLimit) {
            alert(`‚ö†Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß!\n‡∏Ñ‡∏∏‡∏ì‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î Stop Loss (${stopLossLimit}) ‡πÅ‡∏•‡πâ‡∏ß\n‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö`);
            return; 
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô "‡∏Å‡πà‡∏≠‡∏ô" ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡∏Å‡∏î Undo
        stateHistory.push({
            balance: balance,
            betStep: betStep,
            lastPred: lastPred,
            resText: document.getElementById('lastResTxt').innerText,
            resColor: document.getElementById('lastResTxt').style.color
        });

        const currentSteps = getMartSteps();

        // ‡∏Ñ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô
        if (lastPred && v !== 'T') {
            const betAmount = 100 * currentSteps[betStep];
            if (v === lastPred) {
                // ‡∏ä‡∏ô‡∏∞
                balance += (v === 'B' ? betAmount * 0.95 : betAmount);
                document.getElementById('lastResTxt').innerText = "WIN ‚úì";
                document.getElementById('lastResTxt').style.color = "#00e676";
                betStep = 0; 
            } else {
                // ‡πÅ‡∏û‡πâ
                balance -= betAmount;
                document.getElementById('lastResTxt').innerText = "LOSE ‚úó";
                document.getElementById('lastResTxt').style.color = "#ff1744";
                betStep++; 
                if (betStep >= currentSteps.length) betStep = 0; 
            }
        }
        
        history.push(v);
        updateUI();
        analyze();
    }

    function generateBigRoad(data) {
        let matrix = [];
        if (!data.length) return matrix;

        let currentCol = [];
        let lastColor = null;

        data.forEach(v => {
            if (v === 'T') {
                if (currentCol.length > 0) {
                    let lastItem = currentCol[currentCol.length - 1];
                    lastItem.ties = (lastItem.ties || 0) + 1;
                } else {
                    currentCol.push({ type: 'T', ties: 1 });
                }
            } else {
                if (v === lastColor) {
                    currentCol.push({ type: v, ties: 0 });
                } else {
                    if (currentCol.length > 0) matrix.push(currentCol);
                    currentCol = [{ type: v, ties: 0 }];
                    lastColor = v;
                }
            }
        });
        if (currentCol.length > 0) matrix.push(currentCol);
        return matrix;
    }

    function updateUI() {
        document.getElementById('profitVal').innerText = Math.floor(balance).toLocaleString();
        document.getElementById('profitVal').style.color = balance >= 0 ? "#00e676" : "#ff1744";
        
        const currentSteps = getMartSteps();
        if (betStep >= currentSteps.length) betStep = 0; 
        
        const currentBet = 100 * currentSteps[betStep];
        document.getElementById('nextBetTxt').innerText = currentBet.toLocaleString();
        document.getElementById('stepNameTxt').innerText = "‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà " + (betStep + 1);
        document.getElementById('stepNameTxt').style.color = betStep > 0 ? "#ff1744" : "#00e676";

        // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Stop Loss ‡∏ó‡∏µ‡πà UI
        const stopLossLimit = parseFloat(document.getElementById('stopLossLimit').value) || -1000;
        if (balance <= stopLossLimit) {
            document.getElementById('profitVal').innerText += " (STOP LOSS)";
        }

        const container = document.getElementById('bigRoad');
        container.innerHTML = '';
        const bigRoad = generateBigRoad(history);
        const tbl = document.createElement('table'); tbl.className = 'grid-table';
        
        for (let r = 0; r < 6; r++) {
            const tr = document.createElement('tr');
            for (let c = 0; c < Math.max(18, bigRoad.length + 1); c++) {
                const td = document.createElement('td'); td.className = 'g-cell';
                if (bigRoad[c] && bigRoad[c][r]) {
                    const item = bigRoad[c][r];
                    const d = document.createElement('div');
                    d.className = `bead bd-${item.type.toLowerCase()}`;
                    
                    if (item.ties > 0) {
                        const slash = document.createElement('div');
                        slash.className = 'tie-slash';
                        d.appendChild(slash);
                    }
                    td.appendChild(d);
                }
                tr.appendChild(td);
            }
            tbl.appendChild(tr);
        }
        container.appendChild(tbl);
        container.scrollLeft = container.scrollWidth;

        saveData(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠ UI ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
    }

    function analyze() {
        const filtered = history.filter(x => x !== 'T');
        if (filtered.length < 4) {
            document.getElementById('aiReason').innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏ö‡πÅ‡∏û‡∏ó‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô...";
            return;
        }

        const provider = document.getElementById('providerSelect').value;
        const bigRoad = generateBigRoad(filtered);
        
        let pScore = 50; 
        let bScore = 50;
        let reason = "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô";

        const lastCol = bigRoad[bigRoad.length - 1];
        const prevCol = bigRoad.length > 1 ? bigRoad[bigRoad.length - 2] : [];
        const lastResult = lastCol[0].type;
        const oppositeResult = lastResult === 'P' ? 'B' : 'P';

        // 1. ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏à‡∏±‡∏ö‡∏°‡∏±‡∏á‡∏Å‡∏£
        if (lastCol.length >= 3) {
            let bonus = provider === 'sa' ? 30 : 15; 
            if (lastResult === 'P') pScore += bonus;
            else bScore += bonus;
            reason = "‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡πÄ‡∏Ñ‡πâ‡∏≤‡πÑ‡∏û‡πà‡∏°‡∏±‡∏á‡∏Å‡∏£ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏ó‡∏á‡∏ï‡∏≤‡∏°‡∏ô‡πâ‡∏≥‡πÑ‡∏´‡∏•";
        }
        // 2. ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏à‡∏±‡∏ö‡∏õ‡∏¥‡∏á‡∏õ‡∏≠‡∏á
        else if (bigRoad.length >= 4 && lastCol.length === 1 && prevCol.length === 1) {
            let bonus = provider === 'sexy' ? 30 : 15; 
            if (oppositeResult === 'P') pScore += bonus;
            else bScore += bonus;
            reason = "‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡πÄ‡∏Ñ‡πâ‡∏≤‡πÑ‡∏û‡πà‡∏õ‡∏¥‡∏á‡∏õ‡∏≠‡∏á ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏ó‡∏á‡∏™‡∏ß‡∏ô‡∏™‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î";
        }
        // 3. ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏™‡∏°‡∏î‡∏∏‡∏•
        else if (provider === 'dg') {
            const pTotal = filtered.filter(x => x === 'P').length;
            const bTotal = filtered.filter(x => x === 'B').length;
            if (pTotal > bTotal) { bScore += 15; reason = "‡∏≠‡∏¥‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏´‡πâ‡∏≠‡∏á ‡∏ù‡∏±‡πà‡∏á‡πÅ‡∏î‡∏á‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏µ‡∏ï‡∏∑‡πâ‡∏ô"; }
            else if (bTotal > pTotal) { pScore += 15; reason = "‡∏≠‡∏¥‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏´‡πâ‡∏≠‡∏á ‡∏ù‡∏±‡πà‡∏á‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏µ‡∏ï‡∏∑‡πâ‡∏ô"; }
        }
        // 4. ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡πÄ‡∏Ñ‡πâ‡∏≤‡πÑ‡∏û‡πà 2 ‡∏ï‡∏±‡∏ß‡∏ï‡∏±‡∏î
        else if (lastCol.length === 2 && prevCol.length >= 2) {
            if (oppositeResult === 'P') pScore += 20;
            else bScore += 20;
            reason = "‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡πÄ‡∏Ñ‡πâ‡∏≤‡πÑ‡∏û‡πà‡∏™‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏ï‡∏±‡∏î ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡∏™‡∏•‡∏±‡∏ö";
        }

        let totalScore = pScore + bScore;
        let pConf = (pScore / totalScore) * 100;
        let bConf = (bScore / totalScore) * 100;
        
        const conf = Math.max(pConf, bConf);
        const finalConf = conf > 95 ? 95 : conf; 

        document.getElementById('aiConfTxt').innerText = finalConf.toFixed(0) + "%";
        document.getElementById('confBar').style.width = finalConf + "%";

        const resEl = document.getElementById('aiResult');
        const reasonEl = document.getElementById('aiReason');

        if (Math.abs(pConf - bConf) < 8) {
            lastPred = null;
            resEl.innerText = "‡∏£‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞"; resEl.className = "ai-result c-w";
            reasonEl.innerText = "‡πÄ‡∏Ñ‡πâ‡∏≤‡πÑ‡∏û‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏£‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏° (Skip)";
        } else if (pConf > bConf) {
            lastPred = 'P';
            resEl.innerText = "PLAYER"; resEl.className = "ai-result c-p";
            reasonEl.innerText = reason;
        } else {
            lastPred = 'B';
            resEl.innerText = "BANKER"; resEl.className = "ai-result c-b";
            reasonEl.innerText = reason;
        }
    }

    function undo() { 
        if (history.length === 0) return; 

        history.pop(); 
        const prevState = stateHistory.pop(); 
        if (prevState) {
            balance = prevState.balance;
            betStep = prevState.betStep;
            lastPred = prevState.lastPred;
            document.getElementById('lastResTxt').innerText = prevState.resText;
            document.getElementById('lastResTxt').style.color = prevState.resColor;
        }

        updateUI(); 
        analyze(); 
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û JPG
    function exportJPG() {
        const element = document.getElementById('captureArea'); 
        html2canvas(element, { backgroundColor: '#050505', scale: 2 }).then(canvas => {
            const link = document.createElement('a');
            const dateStr = new Date().toLocaleDateString('th-TH').replace(/\//g, '-');
            link.download = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•_${dateStr}.jpg`;
            link.href = canvas.toDataURL('image/jpeg', 0.9);
            link.click();
        });
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå PDF
    function exportPDF() {
        const element = document.getElementById('captureArea');
        const dateStr = new Date().toLocaleDateString('th-TH').replace(/\//g, '-');
        const opt = {
            margin:       0.1,
            filename:     `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•_${dateStr}.pdf`,
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2, backgroundColor: '#050505' },
            jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(element).save();
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á LocalStorage
    function saveData() {
        const appData = {
            history: history,
            stateHistory: stateHistory,
            balance: balance,
            betStep: betStep,
            lastPred: lastPred,
            steps: getMartSteps(),
            stopLoss: document.getElementById('stopLossLimit').value,
            provider: document.getElementById('providerSelect').value
        };
        localStorage.setItem('aiMasterData', JSON.stringify(appData));
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å LocalStorage
    function loadData() {
        const saved = localStorage.getItem('aiMasterData');
        if (saved) {
            const data = JSON.parse(saved);
            history = data.history || [];
            stateHistory = data.stateHistory || [];
            balance = data.balance || 0;
            betStep = data.betStep || 0;
            lastPred = data.lastPred || null;

            if (data.steps && data.steps.length === 5) {
                document.getElementById('step1').value = data.steps[0];
                document.getElementById('step2').value = data.steps[1];
                document.getElementById('step3').value = data.steps[2];
                document.getElementById('step4').value = data.steps[3];
                document.getElementById('step5').value = data.steps[4];
            }
            if (data.stopLoss) document.getElementById('stopLossLimit').value = data.stopLoss;
            if (data.provider) document.getElementById('providerSelect').value = data.provider;
        }
    }

    function resetGame() { 
        if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
            localStorage.removeItem('aiMasterData');
            location.reload(); 
        }
    }
    
    // --- ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ---
    loadData();
    updateUI();
    if (history.length > 0) analyze();
</script>
</body>
</html>