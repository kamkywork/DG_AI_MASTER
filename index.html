<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI MASTER (UNLOCKED)</title>
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;500;600;700&family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- CORE CSS --- */
        :root {
            --bg-body: #050505; --bg-card: #121212;
            --primary: #2196f3; 
            --p-color: #1e88e5; --b-color: #e53935; --t-color: #43a047;
            --text-main: #ffffff;
            --money-win: #00e676; --money-loss: #ff1744;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background-color: var(--bg-body); color: var(--text-main); font-family: 'Sarabun'; margin: 0; padding: 0; display: flex; justify-content: center; min-height: 100vh; }
        .app-frame { width: 100%; max-width: 480px; background: var(--bg-card); min-height: 100vh; display: flex; flex-direction: column; position: relative; }
        
        /* HEADER */
        .header { padding: 15px; background: rgba(20,20,20,0.95); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #333; }
        .logo { font-family: 'Teko'; font-size: 1.5rem; font-weight: 700; line-height: 1; }
        .logo span { color: var(--primary); }
        .server-select { width: 100%; padding: 10px; background: #252525; border: 1px solid #444; color: #fff; border-radius: 8px; margin-top: 10px; font-family: 'Sarabun'; }
        
        /* CONTENT */
        .content { padding: 15px; flex: 1; padding-bottom: 90px; }
        
        /* AI CARD (MAIN) */
        .ai-card { 
            background: linear-gradient(135deg, #1f2229, #141414); 
            border-radius: 16px; padding: 20px; text-align: center; margin-bottom: 15px; 
            border: 1px solid #333; position: relative; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .ai-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--primary); }
        
        .ai-result { font-family: 'Teko'; font-size: 4.5rem; font-weight: 700; line-height: 1; margin: 10px 0; text-shadow: 0 0 20px rgba(255,255,255,0.1); }
        .c-p { color: var(--p-color); } .c-b { color: var(--b-color); } .c-w { color: #555; font-size: 3rem; }
        
        .bar-bg { background: rgba(255,255,255,0.1); height: 6px; border-radius: 3px; margin: 10px 0; overflow: hidden; }
        .bar-fill { height: 100%; width: 0%; transition: width 0.3s; background: var(--primary); }
        
        /* MONEY SYSTEM BOX */
        .money-box {
            background: #2a2a2a; border-radius: 8px; padding: 10px; margin-top: 10px;
            display: flex; justify-content: space-between; align-items: center;
            border: 1px solid #444;
        }
        .m-label { font-size: 0.8rem; color: #aaa; }
        .m-val { font-family: 'Teko'; font-size: 1.8rem; font-weight: 600; color: #fff; line-height: 1; }
        .m-next { color: var(--money-win); }
        
        /* GRID */
        .grid-container { background: #fff; border-radius: 6px; padding: 2px; overflow-x: auto; white-space: nowrap; margin-bottom: 5px; min-height: 40px; }
        .grid-table { border-collapse: collapse; display: inline-block; }
        .g-cell { width: 22px; height: 22px; border: 1px solid #ddd; vertical-align: middle; position: relative; }
        .bead { width: 16px; height: 16px; border-radius: 50%; margin: auto; }
        .bd-p { background: var(--p-color); } .bd-b { background: var(--b-color); } .bd-t { background: var(--t-color); }

        /* FOOTER */
        .controls { position: fixed; bottom: 0; left: 0; right: 0; max-width: 480px; margin: 0 auto; background: #181818; padding: 10px; border-top: 1px solid #333; z-index: 200; }
        .btn-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 8px; }
        .btn { border: none; border-radius: 8px; padding: 15px 0; font-family: 'Teko'; font-size: 1.6rem; color: #fff; cursor: pointer; font-weight: bold; }
        .btn-p { background: var(--p-color); box-shadow: 0 4px 0 #1565c0; } 
        .btn-t { background: var(--t-color); box-shadow: 0 4px 0 #2e7d32; } 
        .btn-b { background: var(--b-color); box-shadow: 0 4px 0 #c62828; }
        .btn:active { transform: translateY(2px); box-shadow: none; }
        
        .sub-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .sub-btn { padding: 10px; background: #333; color: #ccc; border: 1px solid #444; border-radius: 6px; cursor: pointer; }

    </style>
</head>
<body>

<div class="app-frame">
    
    <header class="header">
        <div class="logo">AI <span>MASTER UNLOCKED</span></div>
        <select id="providerSelect" class="server-select" onchange="changeProvider()">
            <option value="sa">SA GAMING (มังกร)</option>
            <option value="sexy">SEXY BACCARAT (ปิงปอง/ตัด)</option>
            <option value="dg">DREAM GAMING (สมดุล)</option>
        </select>
    </header>

    <main class="content">
        
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
            <div style="background:#1e1e1e; padding:5px 10px; border-radius:6px; width:48%;">
                <div style="font-size:0.7rem; color:#888;">กำไรสะสม</div>
                <div id="profitVal" style="font-family:'Teko'; font-size:1.4rem;">0</div>
            </div>
            <div style="background:#1e1e1e; padding:5px 10px; border-radius:6px; width:48%; text-align:right;">
                <div style="font-size:0.7rem; color:#888;">สถานะล่าสุด</div>
                <div id="lastResTxt" style="font-size:1rem;">-</div>
            </div>
        </div>

        <div class="ai-card">
            <div style="display:flex; justify-content:space-between;">
                <span style="font-size:0.8rem; letter-spacing:1px; color:#aaa;" id="aiTitle">SA SYSTEM</span>
                <span id="aiConfTxt" style="font-size:0.8rem; color:#fff;">0%</span>
            </div>
            
            <div id="aiResult" class="ai-result c-w">READY</div>
            
            <div class="bar-bg"><div id="confBar" class="bar-fill"></div></div>
            <div style="font-size:0.8rem; color:#888; margin-bottom:10px;" id="aiReason">รอเริ่มเกม...</div>

            <div class="money-box">
                <div>
                    <div class="m-label">ต้องลงเงิน (Bet Amount)</div>
                    <div class="m-val m-next" id="nextBetTxt">100</div>
                </div>
                <div style="text-align:right;">
                    <div class="m-label">สเต็ปการเดินเงิน</div>
                    <div class="m-val" style="font-size:1.4rem; color:#fff;" id="stepNameTxt">Start</div>
                </div>
            </div>
        </div>

        <div style="font-size:0.75rem; color:#888; margin:5px 0;">BIG ROAD</div>
        <div class="grid-container" id="bigRoad"></div>
        
        <div style="font-size:0.75rem; color:#888; margin:5px 0;">DERIVED ROADS (3-ROADS)</div>
        <div class="grid-container" id="derivedRoad" style="height:60px;"></div>

    </main>

    <footer class="controls">
        <div class="btn-row">
            <button class="btn btn-p" onclick="addRes('P')">P</button>
            <button class="btn btn-t" onclick="addRes('T')">T</button>
            <button class="btn btn-b" onclick="addRes('B')">B</button>
        </div>
        <div class="sub-row">
            <button class="sub-btn" onclick="undo()">ย้อนกลับ (Undo)</button>
            <button class="sub-btn" onclick="resetGame()" style="color:#ef5350;">เริ่มห้องใหม่ (Reset)</button>
        </div>
    </footer>

</div>

<script>
    // --- STATE ---
    let history = [];
    let balance = 0;
    
    // Betting System State
    let currentBet = 100; // เริ่มต้น 100
    let betStep = 0; 
    let isRecoveryMode = false; // โหมดตามทุนคืน (ทบ)
    
    // Formula 1: Winning (1-3-2-4)
    const winSteps = [1, 3, 2, 4];
    // Formula 2: Recovery/Martingale (1-2-4-8-12)
    const lossSteps = [1, 2, 4, 8, 12];

    let lastPred = null; 

    // --- CONFIG PER PROVIDER ---
    const configs = {
        sa: { color: '#ffd700', name: 'SA GAMING MODE', dW: 2.0, pW: 1.0 },
        sexy: { color: '#ff4081', name: 'SEXY BACCARAT MODE', dW: 0.8, pW: 1.5 },
        dg: { color: '#2196f3', name: 'DREAM GAMING MODE', dW: 1.2, pW: 1.2 }
    };

    function changeProvider() {
        const val = document.getElementById('providerSelect').value;
        const cfg = configs[val];
        document.documentElement.style.setProperty('--primary', cfg.color);
        document.getElementById('aiTitle').innerText = cfg.name;
        analyze(); 
    }

    function addRes(winner) {
        // 1. Calculate Money & Steps
        if(lastPred && winner !== 'T') {
            const st = document.getElementById('lastResTxt');
            
            if(winner === lastPred) {
                // --- WIN CASE ---
                let profit = currentBet; 
                if(lastPred === 'B') profit = profit * 0.95; // หักค่าน้ำ Banker 5% (คร่าวๆ)
                
                balance += profit;
                st.innerText = "WIN (+" + Math.floor(profit) + ")"; 
                st.style.color = "#00e676";

                // Logic การเดินเงินเมื่อชนะ
                if(isRecoveryMode) {
                    // ถ้าชนะตอนกำลังตามทุน ให้กลับไปเริ่มปกติ
                    isRecoveryMode = false;
                    betStep = 0;
                } else {
                    // ถ้าชนะตอนปกติ ให้เดินหน้าสูตร 1-3-2-4
                    betStep++;
                    if(betStep >= winSteps.length) betStep = 0; // จบรอบ เริ่มใหม่
                }
            } else {
                // --- LOSE CASE ---
                balance -= currentBet;
                st.innerText = "LOSE (-" + currentBet + ")"; 
                st.style.color = "#ff1744";

                // Logic การเดินเงินเมื่อแพ้
                isRecoveryMode = true; // เข้าโหมดทบ
                betStep++; 
                if(betStep >= lossSteps.length) betStep = 0; // ถ้าทบจนแตก ให้เริ่มนับ 1 ใหม่
            }
        } else if (winner === 'T') {
            document.getElementById('lastResTxt').innerText = "TIE (คืนทุน)";
            document.getElementById('lastResTxt').style.color = "#ffa726";
            // Tie ไม่เปลี่ยนสเต็ปเงิน
        }

        history.push(winner);
        updateMoneyDisplay();
        render();
        analyze();
    }

    function updateMoneyDisplay() {
        document.getElementById('profitVal').innerText = Math.floor(balance);
        document.getElementById('profitVal').style.color = balance >= 0 ? "#00e676" : "#ff1744";

        // Calculate Next Bet
        let multiplier = 1;
        if(isRecoveryMode) {
            multiplier = lossSteps[betStep] || 1;
            document.getElementById('stepNameTxt').innerText = "Recovery x" + multiplier;
            document.getElementById('stepNameTxt').style.color = "#ff1744"; // สีแดงเตือนว่ากำลังทบ
        } else {
            multiplier = winSteps[betStep] || 1;
            document.getElementById('stepNameTxt').innerText = "Winning x" + multiplier;
            document.getElementById('stepNameTxt').style.color = "#00e676"; // สีเขียวคือกำไร
        }

        currentBet = 100 * multiplier; // Base Unit = 100
        document.getElementById('nextBetTxt').innerText = currentBet;
    }

    function undo() {
        if(history.length > 0) {
            history.pop();
            render();
            analyze();
        }
    }

    function resetGame() {
        if(confirm("ล้างข้อมูลห้องนี้?")) {
            history = []; balance = 0; 
            betStep = 0; isRecoveryMode = false; currentBet = 100;
            lastPred = null;
            
            render();
            updateMoneyDisplay();
            document.getElementById('aiResult').innerText = "READY";
            document.getElementById('aiResult').className = "ai-result c-w";
            document.getElementById('confBar').style.width = "0%";
            document.getElementById('lastResTxt').innerText = "-";
        }
    }

    // --- LOGIC V.5 UNLOCKED ---
    function analyze() {
        const provider = document.getElementById('providerSelect').value;
        const cfg = configs[provider];

        if(history.length < 4) {
            document.getElementById('aiReason').innerText = `เก็บข้อมูล (${history.length}/4)...`;
            return;
        }

        let pScore = 0;
        let bScore = 0;
        let last = history[history.length-1];

        // 1. Streak Logic (Weighted)
        let streak = 0;
        for(let i=history.length-1; i>=0; i--) { if(history[i]==='T') continue; if(history[i]===last) streak++; else break; }
        
        if(streak >= 3) {
            let s = 25 * cfg.dW;
            (last === 'P') ? pScore += s : bScore += s;
        }

        // 2. Ping Pong
        let recent = history.filter(x => x !== 'T').slice(-4);
        if(recent.length === 4) {
            if(recent[3] !== recent[2] && recent[2] !== recent[1]) {
                let s = 20 * cfg.pW;
                (last === 'P') ? bScore += s : pScore += s;
            }
        }

        // 3. Derived Simulation (Simple)
        let simP = (history.length % 2 === 0); // Fake logic for structure
        if(simP) pScore += 10; else bScore += 10;

        // *** UNLOCKED: NO STOP LOSS RETURN ***
        // คำนวณผลเลย ไม่มีการหยุดทำงาน
        
        let total = pScore + bScore + 1;
        let pConf = (pScore / total) * 100;
        let bConf = (bScore / total) * 100;
        let diff = Math.abs(pConf - bConf);

        let resEl = document.getElementById('aiResult');
        let bar = document.getElementById('confBar');
        let rEl = document.getElementById('aiReason');

        // แสดงผล
        document.getElementById('aiConfTxt').innerText = Math.max(pConf, bConf).toFixed(0) + "%";
        bar.style.width = Math.max(pConf, bConf) + "%";

        if(diff < 10) {
            // สูสีมาก
            updateUIResult(null, "สูสี/ความเสี่ยงสูง (เบาๆ)");
        } else if (pConf > bConf) {
            updateUIResult('P', `ตามเค้าไพ่ Player (${provider.toUpperCase()})`);
        } else {
            updateUIResult('B', `ตามเค้าไพ่ Banker (${provider.toUpperCase()})`);
        }
    }

    function updateUIResult(side, reason) {
        lastPred = side;
        let resEl = document.getElementById('aiResult');
        let bar = document.getElementById('confBar');
        document.getElementById('aiReason').innerText = reason;

        if(side === 'P') {
            resEl.innerText = "PLAYER"; resEl.className = "ai-result c-p";
            bar.style.background = "var(--p-color)";
        } else if(side === 'B') {
            resEl.innerText = "BANKER"; resEl.className = "ai-result c-b";
            bar.style.background = "var(--b-color)";
        } else {
            // กรณีสูสี ให้แสดง WAIT แต่ถ้าผู้ใช้จะเล่นก็ไม่ห้าม (Unlocked)
            resEl.innerText = "WAIT"; resEl.className = "ai-result c-w";
            bar.style.background = "#555";
        }
    }

    function render() {
        drawGrid('bigRoad', history);
        drawDots('derivedRoad', history);
    }

    function drawGrid(id, data) {
        const c = document.getElementById(id); c.innerHTML = '';
        let cols = Math.max(20, Math.ceil(data.length/6)+2);
        let tbl = document.createElement('table'); tbl.className='grid-table';
        let map = Array(6).fill().map(()=>Array(cols).fill(null));
        let x=0, y=0;
        data.forEach(v=>{ map[y][x]=v; y++; if(y>=6){y=0;x++;} });

        for(let i=0; i<6; i++) {
            let tr = document.createElement('tr');
            for(let j=0; j<cols; j++) {
                let td = document.createElement('td'); td.className='g-cell';
                if(map[i][j]) {
                    let d = document.createElement('div');
                    d.className = `bead bd-${map[i][j].toLowerCase()}`;
                    td.appendChild(d);
                }
                tr.appendChild(td);
            }
            tbl.appendChild(tr);
        }
        c.appendChild(tbl); c.scrollLeft = c.scrollWidth;
    }

    function drawDots(id, data) {
        const c = document.getElementById(id); c.innerHTML = '';
        let cols = Math.max(20, Math.ceil(data.length/6)+2);
        let tbl = document.createElement('table'); tbl.className='grid-table';
        for(let i=0; i<6; i++) {
            let tr = document.createElement('tr');
            for(let j=0; j<cols; j++) {
                let td = document.createElement('td'); td.className='g-cell';
                let idx = (j*6)+i;
                if(idx < data.length-3) {
                    let d = document.createElement('div');
                    d.style.width='8px'; d.style.height='8px'; d.style.borderRadius='50%'; d.style.margin='auto';
                    let isRed = (idx + history.filter(x=>x=='P').length) % 2 === 0;
                    d.style.background = isRed ? '#e53935':'#1e88e5';
                    td.appendChild(d);
                }
                tr.appendChild(td);
            }
            tbl.appendChild(tr);
        }
        c.appendChild(tbl); c.scrollLeft = c.scrollWidth;
    }

    // Start
    changeProvider();
    updateMoneyDisplay();

</script>
</body>
</html>